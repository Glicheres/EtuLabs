Алгоритм писался одной ночью
прошу стого не судить - но косяки подмечать